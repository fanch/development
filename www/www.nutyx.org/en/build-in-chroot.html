<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
     "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
   
<!-- Mirrored from www.nutyx.org/en/build-in-chroot by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 02 Jul 2017 10:31:18 GMT -->
<HEAD>
      <TITLE>NuTyX GNU/Linux</TITLE>
      <META charset="utf-8" />
      <LINK rel="shortcut icon" href="../favicon.html">
 <style type="text/css">
 body{
   text-align: left;
   color: #444;
   background: #eee url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAMAAAC6sdbXAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRF3d3d////riJKgAAAAAJ0Uk5T/wDltzBKAAAAFUlEQVR42mJgBAEGGMmAxAYCgAADAAGGABmnk/7aAAAAAElFTkSuQmCC); 
   font: 14px;
}
header {
   float: left;
   padding-top: 6px;
   padding-left: 2%;
   margin-right: 2%;
   background-color: #606060;
}
nav { padding-top: 1px; }
/* horizontally center ul element */
nav ul { text-align:center; }
nav li {
    /* make list elements fall inline as block elements */
    position: relative;
    display: inline-block;
    /* next two lines only for display purposes */
    text-align: center;
    border:1px solid black;
}
nav li a {
    font-size:12px;
    text-decoration: none;
    float:left;
    padding:10px;
    background-color: #333333;
    color:#ffffff;
    border-bottom:1px;
    border-bottom-color:#000000;
    border-bottom-style:solid;
}
nav li a:hover {
    background-color:#9B1C26;
    border-bottom-color:#000000;
    border-bottom-style:solid;
}
img { border: 0; }
nav.img { border: 0; }
h1 { text-decoration: underline; }

p1 {
    display: inline-block;
    vertical-align: top;
    text-align: left;
    color:#585858;
    font-size:1em;
}
pre {
   padding: 0.5em 1em;
   margin: 1em 0em 1em 2em;
   font-weight:bold;
   color: black;
   font-family: monospace;
   background-color: #D0D0D0;
}
td { padding: 0.5em 0.5em 0.5em 0.5em; }
tr.header { color: white; background-color: #606060; }
tr.odd { background-color: #D0D0D0; }
.sidebar { background-color: #E0E0E0; }
pre.command { border-left: 0.2em solid #C70000; }
pre.command_user { border-left: 0.2em solid #00C700; }
pre.output { font-weight:normal; }
div.important {
   margin: 1em 2em 1em 2em;
   font-size: 1.2em;
   color:#883333;
   padding: 0.5em 0.5em 0.5em 0.5em;
   border: 2px solid #866;
}
div.note {
   margin: 1em 2em 1em 0em;
   font-size: 1em;
   color:#333388;
   border: 2px solid #dbddec;
   padding: 0.5em 0.5em 0.5em 0.5em;
}
div.toc {
   margin: 0em 0em 0em 0em;
   font-size: 0.9em;
   border: 1px solid #999999;
   padding: 0em 2em 0em 1em;
   width: -moz-max-content;
   background-color: #e9e9ef;
}
div.important img { padding: 0.4em; }
div.note img { padding: 0em 0.4em; }
div.pied_page { text-align: center; }
a { color: #F64825; }
#foot {
    text-align: center;
    text-decoration-color: #000000;
    font-size: 10px;
}
/* Last edited info */
p.updated {
    text-align: left;
    font-size: small;
    font-weight: bold;
    font-style: italic;
}
a:link {
    color: #703030;
    text-decoration: none;
}
a:visited {
    color: #0b0080;
}
a:hover {
    color: #403030;
    text-decoration: underline;
}
table {
    width: 100%;
}
td.menu {
    font: courrier;
    background-color: #959595;
    text-decoration: none;
    vertical-align:middle;
    text-align:center;
    height:60px;
}
td.menu:hover {
    text-decoration: none;
    background-color: #AAAAAA;
    text-transform: uppercase;
}
td.menu a:link {
    font-weight:bold;
    color: black;
    text-decoration: none;
    font-family: arial;
}
td.menu a:visited {
    font-weight:bold;
    color: black;
    text-decoration: none;
    font-family: arial;
}
td.menu a:hover {
    color: black;
    text-decoration: none;
    font-family: arial;
}
 @media print { header, footer {display:none } }
 </style>
</head>
<body>
    <table>
     <tr>
      <td>
       <a href=".html"><img id="logo" src="../graphics/logo_nutyx_120.png" alt="logo nutyx" /></a>
      </td>
      <td>
       <table>
        <tr>
            <td class="menu"><br><a href="news.html">News</a><br><br>
            <td class="menu"><br><a href="information.html">Information</a><br><br>
            <td class="menu"><br><a href="documentation.html">Documentation</a><br><br>
            <td class="menu"><br><a href="installation.html">Installation</a><br><br>
            <td class="menu"><br><a href="packages.html">Packages</a><br><br>
            <td class="menu"><br><a href="faq.html">FAQ</a><br><br>
        </tr>
        <tr>
            <td class="menu"><br><a href="http://downloads.nutyx.org/?C=M;O=D">Downloads</a><br><br>
            <td class="menu"><br><a href="http://forums.nutyx.org/index.php?action=recent">Forum</a><br><br>
            <td class="menu"><br><a href="http://github.com/NuTyX">Code</a><br><br>
            <td class="menu"><br><a href="screenshots.html">Screenshots</a><br><br>
            <td class="menu"><br><a href="wallpapers.html">Wallpapers</a><br><br>
            <td class="menu"><br><a href="../fr/index.html" title="Acceuil"> <img src="../graphics/fr.gif" alt="Accueil" height="12" width="35"></a><br><br>
        </tr>
       </table>
      </td>
     </tr>
    </table>
   <hr>
<table border="0" cellpadding="15" cellspacing="10" width="100%">
 <tr valign="top">
  <td class="sidebar" width="20%">
   <h4>Forum</h4>
    <div>
<p class="updated">Sun Jun 25 16:07:12 2017 UTC</p><div style="text-transform: uppercase;">General:</div><b>News</b><br><i>tnut</i><br><img src="../graphics/xx.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=197.msg614#msg614">New ISO  with LIVE mode available</a><br><br>
<hr align="center" style="width: 50%;">
<p class="updated">Mon Jun 12 19:48:17 2017 UTC</p><div style="text-transform: uppercase;">INSTALL:</div><b>From GIT</b><br><i>tnut</i><br><img src="../graphics/xx.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=196.msg613#msg613">Re: Error in 2nd pass of &quot;build your own&quot;</a><br><br>
<hr align="center" style="width: 50%;">
<p class="updated">Sun May 28 22:40:06 2017 UTC</p><div style="text-transform: uppercase;">INSTALL:</div><b>From GIT</b><br><i>myrddin</i><br><img src="../graphics/thumbup.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=196.msg612#msg612">Re: Error in 2nd pass of &quot;build your own&quot;</a><br><br>
<hr align="center" style="width: 50%;">
<p class="updated">Sun May 28 17:59:21 2017 UTC</p><div style="text-transform: uppercase;">INSTALL:</div><b>From GIT</b><br><i>tnut</i><br><img src="../graphics/lamp.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=196.msg611#msg611">Re: Error in 2nd pass of &quot;build your own&quot;</a><br><br>
<hr align="center" style="width: 50%;">
<p class="updated">Fri May 26 07:30:33 2017 UTC</p><div style="text-transform: uppercase;">INSTALL:</div><b>From GIT</b><br><i>tnut</i><br><img src="../graphics/xx.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=196.msg610#msg610">Re: Error in 2nd pass of &quot;build your own&quot;</a><br><br>
<hr align="center" style="width: 50%;">
<p class="updated">Fri May 26 03:01:17 2017 UTC</p><div style="text-transform: uppercase;">INSTALL:</div><b>From GIT</b><br><i>myrddin</i><br><img src="../graphics/xx.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=196.msg609#msg609">Error in 2nd pass of &quot;build your own&quot;</a><br><br>
<hr align="center" style="width: 50%;">
<p class="updated">Sun May 21 19:31:21 2017 UTC</p><div style="text-transform: uppercase;">Off-Topic:</div><b>Let's talk about you</b><br><i>tnut</i><br><img src="../graphics/xx.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=195.msg608#msg608">Re: New nuty user </a><br><br>
<hr align="center" style="width: 50%;">
<p class="updated">Sun May 21 16:52:07 2017 UTC</p><div style="text-transform: uppercase;">Off-Topic:</div><b>Let's talk about you</b><br><i>john</i><br><img src="../graphics/smiley.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=195.msg607#msg607">New nuty user </a><br><br>
<hr align="center" style="width: 50%;">
<p class="updated">Thu May 18 12:19:48 2017 UTC</p><div style="text-transform: uppercase;">General:</div><b>Cards: The Package Manager</b><br><i>tnut</i><br><img src="../graphics/wink.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=194.msg606#msg606">Re: where are CLI commands such as lspci</a><br><br>
<hr align="center" style="width: 50%;">
<p class="updated">Thu May 18 11:48:07 2017 UTC</p><div style="text-transform: uppercase;">General:</div><b>Cards: The Package Manager</b><br><i>myrddin</i><br><img src="../graphics/xx.gif" alt="" /> <a href="http://forums.nutyx.org/index.php?topic=194.msg605#msg605">Re: where are CLI commands such as lspci</a><br><br>
    </div>
<hr>  <td valign="top" align="left" width="100%">
   <div>
  <form method="get" action="https://www.nutyx.org/en/.">
     <fieldset>
          <label for="search-field">Search ...</label>
          <input id="search-field" type="text" name="search" size="18" maxlength="200" />
     </fieldset>
  </form>
   </div>
    <p class="updated"> Fri Apr 28 18:31:27 2017 UTC</p>
<h1>Build in a chroot</h1>
 
<div class="toc">
 <h2>
Contents
</h2>
  <ul style="list-style-type: none; padding: 0;">
<li><a href="#1">Introduction</a>
<li><a href="#2">Adjust /etc/cards.conf</a>
<li><a href="#3">Installation of your chroot</a>
<li>
 <ul style="list-style-type: none;"><li><a href="#4">The stable branch</a>
<li><a href="#5">The development branch</a>
  </ul>
</li><li><a href="#6">Enter the chroot</a>
<li><a href="#7">Development tools installation</a>
<li><a href="#8">The Configurations files</a>
<li>
 <ul style="list-style-type: none;"><li><a href="#9">/etc/cards.conf</a>
<li><a href="#10">/etc/pkgmk.conf</a>
  </ul>
</li><li><a href="#11">Binaries synchronisation via rsync</a>
<li>
 <ul style="list-style-type: none;"><li><a href="#12">The stable branch</a>
<li><a href="#13">The development branch</a>
  </ul>
</li><li><a href="#14">Compilation and installation of your package</a>
<li><a href="#15">Conclusion</a>
</ul>
</div>
<a name="1"></a> <h2>Introduction</h2>
  <p>
   This article explain every step to compile packages in a chroot.

<a name="2"></a> <h2>Adjust /etc/cards.conf</h2>
  <p>
   To be able to install the compiled packages from your chroot, you need to adjust your <b>/etc/cards.conf</b> file.
   You will add on the top of this file:
   <pre class="output">dir /mnt/hd/usr/ports/perso</pre>
  <p>
   You are now ready to proceed with your chroot.

<a name="3"></a> <h2>Installation of your chroot</h2>
  <p>
   Depending the branch you want to use, you can specify it when calling the script:
<a name="4"></a>  <h3>The stable branch</h3>
   <pre class="command"><kbd>VERSION="stable" install-nutyx</kbd></pre>
<a name="5"></a>  <h3>The development branch</h3>
    <pre class="command"><kbd>VERSION="development" install-nutyx</kbd></pre>

<a name="6"></a> <h2>Enter the chroot</h2>
  <p>
  <pre class="command"><kbd>install-nutyx -ec</kbd></pre>

<a name="7"></a> <h2>Development tools installation</h2>
  <p>
   The default installation is already adapted so just do a little:
   <pre class="command"><kbd>get cards.devel</kbd></pre>

<a name="8"></a> <h2>The Configurations files</h2>
<a name="9"></a>  <h3>/etc/cards.conf</h3>
   <pre class="command"><kbd>cat &gt;/etc/cards.conf &lt;&lt; EOF
dir /usr/ports/perso
dir /usr/ports/gui
dir /usr/ports/cli
dir /usr/ports/base
logdir /var/log/pkgbuild
base /usr/ports/base
EOF</kbd></pre>
   <p>
    A folder containing my personnal receipes is added.
    We do not specify any URL because we don't plan to use <b>cards sync</b>.
   <p>
    Folder/var/log/pkgbuild will contains compilations logs.
   <p>
    I don't need any specific locale, they can be all installed.
   <p>
    The folder /usr/ports/base define the base system when the command <b>cards base -r</b>.
    will be used.
<a name="10"></a>  <h3>/etc/pkgmk.conf</h3>
    <pre class="command"><kbd>cat &gt; /etc/pkgmk.conf &lt;&lt; EOF
export CFLAGS="-O2 -pipe"
export CXXFLAGS="${CFLAGS}"
case \${PKGMK_ARCH} in
    "x86_64"|"")
       export MAKEFLAGS="-j$(getconf _NPROCESSORS_ONLN)"
       ;;
    "i686")
       export MAKEFLAGS="-j$(getconf _NPROCESSORS_ONLN)"
       export CFLAGS="${CFLAGS} -m32"
       export CXXFLAGS="${CXXFLAGS} -m32"
       export LDFLAGS="${LDFLAGS} -m32"
       ;;
    *)
       echo "Unknown architecture selected! Exiting."
       exit 1
       ;;
esac
PKGMK_SOURCE_DIR="/tmp"
PKGMK_KEEP_SOURCES="yes"
PKGMK_WORK_DIR="/tmp/work"
PKGMK_IGNORE_REPO="no"
PKGMK_IGNORE_COLLECTION="no"
PKGMK_GROUPS=()
PKGMK_LOCALES=()
PKGMK_COMPRESS_PACKAGE="yes"
PKGMK_COMPRESSION_MODE="xz"
PKGMK_CLEAN="no"
PKGMK_IGNORE_RUNTIMEDEPS="no"
EOF</kbd></pre>
    <p>
     Source code are stored in a common folder. I want to keep them.
    <p>
     The produced binaries are compressed in xz format.
    <p>
     I want to keep my binaries onces installed.
    <p>
     I wish to have the runtime dependencies automaticaly added into the binary.

<a name="11"></a> <h2>Binaries synchronisation via rsync</h2>
    <p>
     This operation consist of download all the binaries of the <b>base, cli-extra, gui et gui-extra</b> colletions. 
     It can take from a few minutes to a few hours depending of the speed of your internet connection.
    <p>
     Lucky, this operation has to be done only once.
     <img src="../graphics/smiley-laughing.gif" alt="Laughing" title="Laughing" />
     <img src="../graphics/smiley-laughing.gif" alt="Laughing" title="Laughing" />
     <img src="../graphics/smiley-laughing.gif" alt="Laughing" title="Laughing" />.
    <p>
     We need to create the root folder first.
    <pre class="command"><kbd>mkdir -p /usr/ports/perso</kbd></pre>
    <p>
     We can now synchronise all the binaries:
<a name="12"></a>    <h3>The stable branch</h3>
    <pre class="command"><kbd>for i in base cli gui
do
  rsync -avz --delete-after rsync://downloads.nutyx.org/nutyx/`uname -m`/stable/$i/ \
  /usr/ports/$i/
done</kbd></pre>
<a name="13"></a>    <h3>The development branch</h3>
     <pre class="command"><kbd>for i in base cli gui
do
  rsync -avz --delete-after rsync://downloads.nutyx.org/nutyx/`uname -m`/development/$i/ \
  /usr/ports/$i/
done</kbd></pre>
    <p>
     This can takes some times so go get a coffee or a pizza.
     <img src="../graphics/smiley-laughing.gif" alt="Laughing" title="Laughing" />,
     It can be long...

<a name="14"></a> <h2>Compilation and installation of your package</h2>
  <p>
   You start to create the folder where will be locate your new package. Let's call it <b>mypackage</b> (you need to adjust to your real one)
   <pre class="command"><kbd>mkdir /usr/ports/perso/mypackage</kbd></pre>
  <p>
   We just need to create the recept of our package (you need to adjust to your real one):
   <pre class="output"># Depends on: python gtk3 librsvg
description="My first package with plenty of  dependancies"
packager="francis perrin"
url="http://www.my-first-package.org/"
name=mypackage
version=1.0.0
release=1
source=(${url}downloads/$name/$name-$version.tar.xz)
build() {
   cd $name-$version
   ./configure --prefix=/usr
   make
   make DESTDIR=$PKG install
}</pre>
  <p>
   We can now launch the process of compilation and installation.
   <pre class="command"><kbd>cards create -r mypackage</kbd></pre>
  <p>
   I suggest you to read the man page of cards to understand the way <b>cards create -r</b> is working.
   <pre class="command"><kbd>man cards</kbd></pre>

<a name="15"></a> <h2>Conclusion</h2>
   <p>
    Following commands should be used:
      <pre class="command"><kbd>cards level
cards base -r
cards create -r</kbd></pre>
<hr>
    <footer >
     <p id="foot"> Powered by cards 2.2.2.2     &copy; 2007 - 2017 <a href=".html">NuTyX</a>.<br><br>
Hosted by <a href="http://tuxfamily.org/"><img src="../graphics/logo_tuxfamily_50.png"/></a><br><br>
     <a href="http://www.wtfpl.net/">
     <img src="http://www.wtfpl.net/wp-content/uploads/2012/12/wtfpl-badge-4.png"
     width="80" height="15" alt="WTFPL" /></a> 
     <a href="http://www.anybrowser.org/campaign/">
       <img src="../graphics/abblue.gif" width="80" height="15"
       alt="anybrowser"></a>
    </footer>
   </tr>
  </table>
 </body>

<!-- Mirrored from www.nutyx.org/en/build-in-chroot by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 02 Jul 2017 10:31:18 GMT -->
</html>
